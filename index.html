<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Click and Surprise</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Anime.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
      .popup {
        display: flex;
        flex-direction: column;
        position: absolute;
        width: 350px;
        height: 220px;
        opacity: 0;
        z-index: 10;
      }
      .popup.visible { opacity: 1; }
      .heart, .snowflake, .star, .cloud, .moon, .catpaw {
        position: absolute;
        pointer-events: none;
      }
    </style>
  </head>
  <body class="bg-pink-100 flex justify-center items-center h-screen font-sans overflow-hidden relative">
    <div class="container text-center z-20">
      <button
        id="clickButton"
        class="bg-pink-300 text-white py-3 px-6 rounded-lg text-xl cursor-pointer hover:scale-110 transform transition-transform duration-300"
      >
        Click vào đây
      </button>
    </div>

    <script>
      const clickButton = document.getElementById("clickButton");
      const maxPopups = 80;
      let generating = false;
      let nextTimeout = null;

      // --- chuẩn bị decorative icons chỉ 1 lần ---
      const iconsConfig = [
        { type: "heart", src: "https://res.cloudinary.com/dsosczr7j/image/upload/v1746725395/klipartz.com_2_qjdmlj.png" },
        { type: "snowflake", src: "https://res.cloudinary.com/dsosczr7j/image/upload/v1746725395/klipartz.com_2_qjdmlj.png" },
        { type: "star", src: "https://res.cloudinary.com/dsosczr7j/image/upload/v1746725396/klipartz.com_9_xynwhs.png" },
        { type: "cloud", src: "https://res.cloudinary.com/dsosczr7j/image/upload/v1746725647/klipartz.com_6_x9trut.png" },
        { type: "moon", src: "https://res.cloudinary.com/dsosczr7j/image/upload/v1746725395/klipartz.com_3_bu1sd5.png" },
        { type: "catpaw", src: "https://res.cloudinary.com/dsosczr7j/image/upload/v1746725395/klipartz.com_kcq7bd.png" },
      ];
      function createDecorativeIcon(type, src, size) {
        const icon = document.createElement("img");
        icon.src = src;
        icon.alt = type;
        icon.classList.add(type, `w-${size}`, `h-${size}`, "z-50");
        resetIcon(icon);
        document.body.appendChild(icon);
        return icon;
      }
      function resetIcon(icon) {
        icon.style.left = `${Math.random() * window.innerWidth}px`;
        icon.style.top = `-24px`;
      }

      // Sinh decorative icons một lần
      const decorativeIcons = [];
      iconsConfig.forEach(cfg => {
        for (let i = 0; i < 6; i++) {
          decorativeIcons.push(createDecorativeIcon(cfg.type, cfg.src, 6));
        }
      });
      // Khởi animation cho icons
      decorativeIcons.forEach((icon, i) => {
        anime({
          targets: icon,
          translateY: [0, window.innerHeight + 50],
          translateX: () => anime.random(-100, 100),
          rotate: anime.random(-30, 30),
          scale: anime.random(0.7, 1.3),
          opacity: [0, 1, 0],
          easing: "easeInOutSine",
          duration: anime.random(4000, 6000),
          loop: true,
          delay: i * 300,
          update(anim) {
            if (anim.progress > 95) {
              resetIcon(icon);
              anim.seek(0);
            }
          }
        });
      });

      clickButton.addEventListener("click", () => {
        if (generating) return;
        generating = true;
        document.querySelector(".container").classList.add("hidden");
        scheduleNextPopup();
      });

      function scheduleNextPopup() {
        // random delay từ 100ms đến 300ms
        const delay = Math.random() * (300 - 100) + 100;
        nextTimeout = setTimeout(() => {
          createPopup();
          scheduleNextPopup();
        }, delay);
      }

      function createPopup() {
        // nếu vượt max, remove cũ nhất
        const existing = document.querySelectorAll(".popup");
        if (existing.length >= maxPopups) existing[0].remove();

        const popup = document.createElement("div");
        popup.classList.add("popup", "bg-white", "border-4", "border-pink-300", "rounded-lg", "shadow-2xl");

        // header
        const header = document.createElement("div");
        header.classList.add("popup-header", "bg-pink-300", "p-2", "flex", "justify-between", "items-center", "rounded-t-lg", "relative");
        const img = document.createElement("img");
        img.src = "https://img.lostbird.vn/2019/12/meo-2.jpg";
        img.alt = "Cat";
        img.classList.add("absolute", "-top-3", "-left-3", "w-10", "h-10", "rounded-full");
        header.appendChild(img);
        ["minimize","maximize","close"].forEach(cls => {
          const btn = document.createElement("div");
          btn.classList.add(cls, "w-3","h-3","rounded-full","cursor-pointer");
          btn.classList.add(
            cls==="minimize"?"bg-yellow-400":
            cls==="maximize"?"bg-green-400":"bg-red-400"
          );
          header.appendChild(btn);
        });

        // body
        const body = document.createElement("div");
        body.classList.add("popup-body", "p-6","flex","flex-col","justify-center","items-center","text-xl","text-pink-600","text-center","relative");
        const text = document.createElement("div");
        text.innerText = "hé lô cưng";
        const cat = document.createElement("img");
        cat.src = "https://img.lostbird.vn/2019/12/meo-2.jpg";
        cat.alt = "Cat";
        cat.classList.add("mt-2","w-24","h-24");
        const paw = document.createElement("img");
        paw.src = "https://img.icons8.com/emoji/48/000000/paw-prints.png";
        paw.alt = "Paw";
        paw.classList.add("absolute","top-2","right-2","w-6","h-6");
        body.append(text, cat, paw);

        popup.append(header, body);
        document.body.appendChild(popup);

        popup.style.left = `${Math.random()*(window.innerWidth-350)}px`;
        popup.style.top  = `${Math.random()*(window.innerHeight-220)}px`;

        setTimeout(() => {
          popup.classList.add("visible");
          anime({
            targets: popup,
            scale: [0,1],
            rotate: [anime.random(-15,15),0],
            translateY: [60,0],
            opacity: [0,1],
            easing: "spring(1,90,12,0)",
            duration: 1000,
          });
          anime({
            targets: cat,
            scale: [1,1.15,1],
            easing: "easeInOutQuad",
            duration: 1200,
            loop: true,
          });
          anime({
            targets: paw,
            translateY: [-12,0],
            rotate: [0,anime.random(-20,20)],
            easing: "easeInOutQuad",
            duration: 700,
            loop: true,
            direction: "alternate",
          });
        }, 100);
      }
    </script>
  </body>
</html>
